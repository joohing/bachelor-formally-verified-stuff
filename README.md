Version of the implementation from our real repository with stricter types. This contains formal verification proofs as well.
